{"ast":null,"code":"import { defineComponent, inject, ref, computed, watch, resolveComponent, openBlock, createElementBlock, normalizeClass, Fragment, renderList, normalizeStyle, createVNode, withCtx, createBlock, resolveDynamicComponent, createCommentVNode, toDisplayString } from 'vue';\nimport { isObject, isArray } from '@vue/shared';\nimport '../../../tokens/index.mjs';\nimport '../../../utils/index.mjs';\nimport '../../../constants/index.mjs';\nimport { ElIcon } from '../../icon/index.mjs';\nimport { StarFilled, Star } from '@element-plus/icons-vue';\nimport '../../../hooks/index.mjs';\nimport { rateProps, rateEmits } from './rate.mjs';\nimport _export_sfc from '../../../_virtual/plugin-vue_export-helper.mjs';\nimport { formContextKey } from '../../../tokens/form.mjs';\nimport { useSize } from '../../../hooks/use-common-props/index.mjs';\nimport { useNamespace } from '../../../hooks/use-namespace/index.mjs';\nimport { UPDATE_MODEL_EVENT } from '../../../constants/event.mjs';\nimport { EVENT_CODE } from '../../../constants/aria.mjs';\nimport { hasClass } from '../../../utils/dom/style.mjs';\n\nfunction getValueFromMap(value, map) {\n  const isExcludedObject = val => isObject(val);\n\n  const matchedKeys = Object.keys(map).map(key => +key).filter(key => {\n    const val = map[key];\n    const excluded = isExcludedObject(val) ? val.excluded : false;\n    return excluded ? value < key : value <= key;\n  }).sort((a, b) => a - b);\n  const matchedValue = map[matchedKeys[0]];\n  return isExcludedObject(matchedValue) && matchedValue.value || matchedValue;\n}\n\nconst _sfc_main = defineComponent({\n  name: \"ElRate\",\n  components: {\n    ElIcon,\n    StarFilled,\n    Star\n  },\n  props: rateProps,\n  emits: rateEmits,\n\n  setup(props, {\n    emit\n  }) {\n    const elForm = inject(formContextKey, {});\n    const rateSize = useSize();\n    const ns = useNamespace(\"rate\");\n    const currentValue = ref(props.modelValue);\n    const hoverIndex = ref(-1);\n    const pointerAtLeftHalf = ref(true);\n    const rateKls = computed(() => [ns.b(), ns.m(rateSize.value)]);\n    const rateDisabled = computed(() => props.disabled || elForm.disabled);\n    const text = computed(() => {\n      let result = \"\";\n\n      if (props.showScore) {\n        result = props.scoreTemplate.replace(/\\{\\s*value\\s*\\}/, rateDisabled.value ? `${props.modelValue}` : `${currentValue.value}`);\n      } else if (props.showText) {\n        result = props.texts[Math.ceil(currentValue.value) - 1];\n      }\n\n      return result;\n    });\n    const valueDecimal = computed(() => props.modelValue * 100 - Math.floor(props.modelValue) * 100);\n    const colorMap = computed(() => isArray(props.colors) ? {\n      [props.lowThreshold]: props.colors[0],\n      [props.highThreshold]: {\n        value: props.colors[1],\n        excluded: true\n      },\n      [props.max]: props.colors[2]\n    } : props.colors);\n    const activeColor = computed(() => getValueFromMap(currentValue.value, colorMap.value));\n    const decimalStyle = computed(() => {\n      let width = \"\";\n\n      if (rateDisabled.value) {\n        width = `${valueDecimal.value}%`;\n      } else if (props.allowHalf) {\n        width = \"50%\";\n      }\n\n      return {\n        color: activeColor.value,\n        width\n      };\n    });\n    const componentMap = computed(() => isArray(props.icons) ? {\n      [props.lowThreshold]: props.icons[0],\n      [props.highThreshold]: {\n        value: props.icons[1],\n        excluded: true\n      },\n      [props.max]: props.icons[2]\n    } : props.icons);\n    const decimalIconComponent = computed(() => getValueFromMap(props.modelValue, componentMap.value));\n    const voidComponent = computed(() => rateDisabled.value ? props.disabledVoidIcon : props.voidIcon);\n    const activeComponent = computed(() => getValueFromMap(currentValue.value, componentMap.value));\n    const iconComponents = computed(() => {\n      const result = Array.from({\n        length: props.max\n      });\n      const threshold = currentValue.value;\n      result.fill(activeComponent.value, 0, threshold);\n      result.fill(voidComponent.value, threshold, props.max);\n      return result;\n    });\n\n    function showDecimalIcon(item) {\n      const showWhenDisabled = rateDisabled.value && valueDecimal.value > 0 && item - 1 < props.modelValue && item > props.modelValue;\n      const showWhenAllowHalf = props.allowHalf && pointerAtLeftHalf.value && item - 0.5 <= currentValue.value && item > currentValue.value;\n      return showWhenDisabled || showWhenAllowHalf;\n    }\n\n    function getIconStyle(item) {\n      const voidColor = rateDisabled.value ? props.disabledVoidColor : props.voidColor;\n      return {\n        color: item <= currentValue.value ? activeColor.value : voidColor\n      };\n    }\n\n    function selectValue(value) {\n      if (rateDisabled.value) {\n        return;\n      }\n\n      if (props.allowHalf && pointerAtLeftHalf.value) {\n        emit(UPDATE_MODEL_EVENT, currentValue.value);\n\n        if (props.modelValue !== currentValue.value) {\n          emit(\"change\", currentValue.value);\n        }\n      } else {\n        emit(UPDATE_MODEL_EVENT, value);\n\n        if (props.modelValue !== value) {\n          emit(\"change\", value);\n        }\n      }\n    }\n\n    function handleKey(e) {\n      if (rateDisabled.value) {\n        return;\n      }\n\n      let _currentValue = currentValue.value;\n      const code = e.code;\n\n      if (code === EVENT_CODE.up || code === EVENT_CODE.right) {\n        if (props.allowHalf) {\n          _currentValue += 0.5;\n        } else {\n          _currentValue += 1;\n        }\n\n        e.stopPropagation();\n        e.preventDefault();\n      } else if (code === EVENT_CODE.left || code === EVENT_CODE.down) {\n        if (props.allowHalf) {\n          _currentValue -= 0.5;\n        } else {\n          _currentValue -= 1;\n        }\n\n        e.stopPropagation();\n        e.preventDefault();\n      }\n\n      _currentValue = _currentValue < 0 ? 0 : _currentValue;\n      _currentValue = _currentValue > props.max ? props.max : _currentValue;\n      emit(UPDATE_MODEL_EVENT, _currentValue);\n      emit(\"change\", _currentValue);\n      return _currentValue;\n    }\n\n    function setCurrentValue(value, event) {\n      if (rateDisabled.value) {\n        return;\n      }\n\n      if (props.allowHalf) {\n        let target = event.target;\n\n        if (hasClass(target, ns.e(\"item\"))) {\n          target = target.querySelector(`.${ns.e(\"icon\")}`);\n        }\n\n        if (target.clientWidth === 0 || hasClass(target, ns.e(\"decimal\"))) {\n          target = target.parentNode;\n        }\n\n        pointerAtLeftHalf.value = event.offsetX * 2 <= target.clientWidth;\n        currentValue.value = pointerAtLeftHalf.value ? value - 0.5 : value;\n      } else {\n        currentValue.value = value;\n      }\n\n      hoverIndex.value = value;\n    }\n\n    function resetCurrentValue() {\n      if (rateDisabled.value) {\n        return;\n      }\n\n      if (props.allowHalf) {\n        pointerAtLeftHalf.value = props.modelValue !== Math.floor(props.modelValue);\n      }\n\n      currentValue.value = props.modelValue;\n      hoverIndex.value = -1;\n    }\n\n    watch(() => props.modelValue, val => {\n      currentValue.value = val;\n      pointerAtLeftHalf.value = props.modelValue !== Math.floor(props.modelValue);\n    });\n\n    if (!props.modelValue) {\n      emit(UPDATE_MODEL_EVENT, 0);\n    }\n\n    return {\n      ns,\n      hoverIndex,\n      currentValue,\n      rateDisabled,\n      text,\n      decimalStyle,\n      decimalIconComponent,\n      iconComponents,\n      rateKls,\n      showDecimalIcon,\n      getIconStyle,\n      selectValue,\n      handleKey,\n      setCurrentValue,\n      resetCurrentValue\n    };\n  }\n\n});\n\nconst _hoisted_1 = [\"aria-valuenow\", \"aria-valuetext\", \"aria-valuemax\"];\nconst _hoisted_2 = [\"onMousemove\", \"onClick\"];\n\nfunction _sfc_render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_icon = resolveComponent(\"el-icon\");\n\n  return openBlock(), createElementBlock(\"div\", {\n    class: normalizeClass(_ctx.rateKls),\n    role: \"slider\",\n    \"aria-valuenow\": _ctx.currentValue,\n    \"aria-valuetext\": _ctx.text,\n    \"aria-valuemin\": \"0\",\n    \"aria-valuemax\": _ctx.max,\n    tabindex: \"0\",\n    onKeydown: _cache[1] || (_cache[1] = (...args) => _ctx.handleKey && _ctx.handleKey(...args))\n  }, [(openBlock(true), createElementBlock(Fragment, null, renderList(_ctx.max, (item, key) => {\n    return openBlock(), createElementBlock(\"span\", {\n      key,\n      class: normalizeClass(_ctx.ns.e(\"item\")),\n      style: normalizeStyle({\n        cursor: _ctx.rateDisabled ? \"auto\" : \"pointer\"\n      }),\n      onMousemove: $event => _ctx.setCurrentValue(item, $event),\n      onMouseleave: _cache[0] || (_cache[0] = (...args) => _ctx.resetCurrentValue && _ctx.resetCurrentValue(...args)),\n      onClick: $event => _ctx.selectValue(item)\n    }, [createVNode(_component_el_icon, {\n      class: normalizeClass([_ctx.ns.e(\"icon\"), {\n        hover: _ctx.hoverIndex === item\n      }]),\n      style: normalizeStyle(_ctx.getIconStyle(item))\n    }, {\n      default: withCtx(() => [!_ctx.showDecimalIcon(item) ? (openBlock(), createBlock(resolveDynamicComponent(_ctx.iconComponents[item - 1]), {\n        key: 0\n      })) : createCommentVNode(\"v-if\", true), _ctx.showDecimalIcon(item) ? (openBlock(), createBlock(_component_el_icon, {\n        key: 1,\n        style: normalizeStyle(_ctx.decimalStyle),\n        class: normalizeClass([_ctx.ns.e(\"icon\"), _ctx.ns.e(\"decimal\")])\n      }, {\n        default: withCtx(() => [(openBlock(), createBlock(resolveDynamicComponent(_ctx.decimalIconComponent)))]),\n        _: 1\n      }, 8, [\"style\", \"class\"])) : createCommentVNode(\"v-if\", true)]),\n      _: 2\n    }, 1032, [\"class\", \"style\"])], 46, _hoisted_2);\n  }), 128)), _ctx.showText || _ctx.showScore ? (openBlock(), createElementBlock(\"span\", {\n    key: 0,\n    class: normalizeClass(_ctx.ns.e(\"text\")),\n    style: normalizeStyle({\n      color: _ctx.textColor\n    })\n  }, toDisplayString(_ctx.text), 7)) : createCommentVNode(\"v-if\", true)], 42, _hoisted_1);\n}\n\nvar Rate = /* @__PURE__ */_export_sfc(_sfc_main, [[\"render\", _sfc_render]]);\n\nexport { Rate as default };","map":{"version":3,"mappings":"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","names":["value","map","val","isObject","Object","key","filter","excluded","sort","a","b","matchedKeys","matchedValue","_sfc_main","defineComponent","name","components","ElIcon","StarFilled","Star","props","emits","setup","emit","inject","formContextKey","rateSize","ns","useNamespace","ref","hoverIndex","pointerAtLeftHalf","computed","m","rateDisabled","disabled","elForm","result","showScore","scoreTemplate","replace","modelValue","currentValue","showText","Math","floor","colorMap","isArray","colors","lowThreshold","highThreshold","max","activeColor","getValueFromMap","width","valueDecimal","allowHalf","color","componentMap","icons","decimalIconComponent","voidComponent","disabledVoidIcon","activeComponent","from","length","threshold","fill","item","showWhenDisabled","voidColor","disabledVoidColor","UPDATE_MODEL_EVENT","e","_currentValue","code","up","EVENT_CODE","right","left","down","event","target","hasClass","clientWidth","offsetX","watch","text","decimalStyle","iconComponents","rateKls","showDecimalIcon","getIconStyle","selectValue","handleKey","setCurrentValue","resetCurrentValue","_createElementBlock","class","_normalizeClass","role","_ctx","tabindex","onKeydown","_cache","_openBlock","_Fragment","_renderList","style","_normalizeStyle","onMousemove","$event","onMouseleave","onClick","_createVNode","hover","_createBlock","_createCommentVNode","openBlock","_resolveDynamicComponent","_","_toDisplayString"],"sources":["../../../../../../packages/components/rate/src/rate.vue"],"sourcesContent":["<template>\n  <div\n    :class=\"rateKls\"\n    role=\"slider\"\n    :aria-valuenow=\"currentValue\"\n    :aria-valuetext=\"text\"\n    aria-valuemin=\"0\"\n    :aria-valuemax=\"max\"\n    tabindex=\"0\"\n    @keydown=\"handleKey\"\n  >\n    <span\n      v-for=\"(item, key) in max\"\n      :key=\"key\"\n      :class=\"ns.e('item')\"\n      :style=\"{ cursor: rateDisabled ? 'auto' : 'pointer' }\"\n      @mousemove=\"setCurrentValue(item, $event)\"\n      @mouseleave=\"resetCurrentValue\"\n      @click=\"selectValue(item)\"\n    >\n      <el-icon\n        :class=\"[ns.e('icon'), { hover: hoverIndex === item }]\"\n        :style=\"getIconStyle(item)\"\n      >\n        <component\n          :is=\"iconComponents[item - 1]\"\n          v-if=\"!showDecimalIcon(item)\"\n        />\n        <el-icon\n          v-if=\"showDecimalIcon(item)\"\n          :style=\"decimalStyle\"\n          :class=\"[ns.e('icon'), ns.e('decimal')]\"\n        >\n          <component :is=\"decimalIconComponent\" />\n        </el-icon>\n      </el-icon>\n    </span>\n    <span\n      v-if=\"showText || showScore\"\n      :class=\"ns.e('text')\"\n      :style=\"{ color: textColor }\"\n    >\n      {{ text }}\n    </span>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent, inject, computed, ref, watch } from 'vue'\nimport { isObject, isArray } from '@vue/shared'\nimport { formContextKey } from '@element-plus/tokens'\nimport { hasClass } from '@element-plus/utils'\nimport { EVENT_CODE, UPDATE_MODEL_EVENT } from '@element-plus/constants'\nimport { ElIcon } from '@element-plus/components/icon'\nimport { StarFilled, Star } from '@element-plus/icons-vue'\nimport { useNamespace, useSize } from '@element-plus/hooks'\nimport { rateProps, rateEmits } from './rate'\n\nimport type { FormContext } from '@element-plus/tokens'\n\nfunction getValueFromMap<T>(\n  value: number,\n  map: Record<string, T | { excluded?: boolean; value: T }>\n) {\n  const isExcludedObject = (\n    val: unknown\n  ): val is { excluded?: boolean } & Record<any, unknown> => isObject(val)\n\n  const matchedKeys = Object.keys(map)\n    .map((key) => +key)\n    .filter((key) => {\n      const val = map[key]\n      const excluded = isExcludedObject(val) ? val.excluded : false\n      return excluded ? value < key : value <= key\n    })\n    .sort((a, b) => a - b)\n  const matchedValue = map[matchedKeys[0]]\n  return (isExcludedObject(matchedValue) && matchedValue.value) || matchedValue\n}\n\nexport default defineComponent({\n  name: 'ElRate',\n  components: {\n    ElIcon,\n    StarFilled,\n    Star,\n  },\n  props: rateProps,\n  emits: rateEmits,\n\n  setup(props, { emit }) {\n    const elForm = inject(formContextKey, {} as FormContext)\n\n    const rateSize = useSize()\n    const ns = useNamespace('rate')\n\n    const currentValue = ref(props.modelValue)\n    const hoverIndex = ref(-1)\n    const pointerAtLeftHalf = ref(true)\n\n    const rateKls = computed(() => [ns.b(), ns.m(rateSize.value)])\n\n    const rateDisabled = computed(() => props.disabled || elForm.disabled)\n    const text = computed(() => {\n      let result = ''\n      if (props.showScore) {\n        result = props.scoreTemplate.replace(\n          /\\{\\s*value\\s*\\}/,\n          rateDisabled.value ? `${props.modelValue}` : `${currentValue.value}`\n        )\n      } else if (props.showText) {\n        result = props.texts[Math.ceil(currentValue.value) - 1]\n      }\n      return result\n    })\n    const valueDecimal = computed(\n      () => props.modelValue * 100 - Math.floor(props.modelValue) * 100\n    )\n    const colorMap = computed(() =>\n      isArray(props.colors)\n        ? {\n            [props.lowThreshold]: props.colors[0],\n            [props.highThreshold]: { value: props.colors[1], excluded: true },\n            [props.max]: props.colors[2],\n          }\n        : props.colors\n    )\n    const activeColor = computed(() =>\n      getValueFromMap(currentValue.value, colorMap.value)\n    )\n    const decimalStyle = computed(() => {\n      let width = ''\n      if (rateDisabled.value) {\n        width = `${valueDecimal.value}%`\n      } else if (props.allowHalf) {\n        width = '50%'\n      }\n      return {\n        color: activeColor.value,\n        width,\n      }\n    })\n    const componentMap = computed(() =>\n      isArray(props.icons)\n        ? {\n            [props.lowThreshold]: props.icons[0],\n            [props.highThreshold]: {\n              value: props.icons[1],\n              excluded: true,\n            },\n            [props.max]: props.icons[2],\n          }\n        : props.icons\n    )\n    const decimalIconComponent = computed(() =>\n      getValueFromMap(props.modelValue, componentMap.value)\n    )\n    const voidComponent = computed(() =>\n      rateDisabled.value ? props.disabledVoidIcon : props.voidIcon\n    )\n    const activeComponent = computed(() =>\n      getValueFromMap(currentValue.value, componentMap.value)\n    )\n    const iconComponents = computed(() => {\n      const result = Array.from({ length: props.max })\n      const threshold = currentValue.value\n      result.fill(activeComponent.value, 0, threshold)\n      result.fill(voidComponent.value, threshold, props.max)\n      return result\n    })\n\n    function showDecimalIcon(item: number) {\n      const showWhenDisabled =\n        rateDisabled.value &&\n        valueDecimal.value > 0 &&\n        item - 1 < props.modelValue &&\n        item > props.modelValue\n      const showWhenAllowHalf =\n        props.allowHalf &&\n        pointerAtLeftHalf.value &&\n        item - 0.5 <= currentValue.value &&\n        item > currentValue.value\n      return showWhenDisabled || showWhenAllowHalf\n    }\n\n    function getIconStyle(item: number) {\n      const voidColor = rateDisabled.value\n        ? props.disabledVoidColor\n        : props.voidColor\n      return {\n        color: item <= currentValue.value ? activeColor.value : voidColor,\n      }\n    }\n\n    function selectValue(value: number) {\n      if (rateDisabled.value) {\n        return\n      }\n      if (props.allowHalf && pointerAtLeftHalf.value) {\n        emit(UPDATE_MODEL_EVENT, currentValue.value)\n        if (props.modelValue !== currentValue.value) {\n          emit('change', currentValue.value)\n        }\n      } else {\n        emit(UPDATE_MODEL_EVENT, value)\n        if (props.modelValue !== value) {\n          emit('change', value)\n        }\n      }\n    }\n\n    function handleKey(e: KeyboardEvent) {\n      if (rateDisabled.value) {\n        return\n      }\n      let _currentValue = currentValue.value\n      const code = e.code\n      if (code === EVENT_CODE.up || code === EVENT_CODE.right) {\n        if (props.allowHalf) {\n          _currentValue += 0.5\n        } else {\n          _currentValue += 1\n        }\n        e.stopPropagation()\n        e.preventDefault()\n      } else if (code === EVENT_CODE.left || code === EVENT_CODE.down) {\n        if (props.allowHalf) {\n          _currentValue -= 0.5\n        } else {\n          _currentValue -= 1\n        }\n        e.stopPropagation()\n        e.preventDefault()\n      }\n      _currentValue = _currentValue < 0 ? 0 : _currentValue\n      _currentValue = _currentValue > props.max ? props.max : _currentValue\n      emit(UPDATE_MODEL_EVENT, _currentValue)\n      emit('change', _currentValue)\n      return _currentValue\n    }\n\n    function setCurrentValue(value: number, event: MouseEvent) {\n      if (rateDisabled.value) {\n        return\n      }\n      if (props.allowHalf) {\n        // TODO: use cache via computed https://github.com/element-plus/element-plus/pull/5456#discussion_r786472092\n        let target = event.target as HTMLElement\n        if (hasClass(target, ns.e('item'))) {\n          target = target.querySelector(`.${ns.e('icon')}`)!\n        }\n        if (target.clientWidth === 0 || hasClass(target, ns.e('decimal'))) {\n          target = target.parentNode as HTMLElement\n        }\n        pointerAtLeftHalf.value = event.offsetX * 2 <= target.clientWidth\n        currentValue.value = pointerAtLeftHalf.value ? value - 0.5 : value\n      } else {\n        currentValue.value = value\n      }\n      hoverIndex.value = value\n    }\n\n    function resetCurrentValue() {\n      if (rateDisabled.value) {\n        return\n      }\n      if (props.allowHalf) {\n        pointerAtLeftHalf.value =\n          props.modelValue !== Math.floor(props.modelValue)\n      }\n      currentValue.value = props.modelValue\n      hoverIndex.value = -1\n    }\n\n    watch(\n      () => props.modelValue,\n      (val) => {\n        currentValue.value = val\n        pointerAtLeftHalf.value =\n          props.modelValue !== Math.floor(props.modelValue)\n      }\n    )\n\n    if (!props.modelValue) {\n      emit(UPDATE_MODEL_EVENT, 0)\n    }\n\n    return {\n      ns,\n      hoverIndex,\n      currentValue,\n      rateDisabled,\n      text,\n      decimalStyle,\n      decimalIconComponent,\n      iconComponents,\n      rateKls,\n\n      showDecimalIcon,\n      getIconStyle,\n      selectValue,\n      handleKey,\n      setCurrentValue,\n      resetCurrentValue,\n    }\n  },\n})\n</script>\n"]},"metadata":{},"sourceType":"module"}
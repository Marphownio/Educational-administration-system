"use strict";(self["webpackChunkvueadmin_vue"]=self["webpackChunkvueadmin_vue"]||[]).push([[752],{6752:function(e,l,a){a.r(l),a.d(l,{default:function(){return k}});var r=a(3396);const t=e=>((0,r.dD)("data-v-0f8330b4"),e=e(),(0,r.Cn)(),e),o=t((()=>(0,r._)("head",null,[(0,r._)("meta",{charset:"UTF-8"}),(0,r._)("title",null,"用户管理")],-1))),m=t((()=>(0,r._)("div",{class:"void"},[(0,r._)("span")],-1))),u={class:"showlist"},d=(0,r.Uk)("添加用户"),i=(0,r.Uk)("通过csv文件添加"),s=(0,r.Uk)("在读"),p=(0,r.Uk)("在岗"),n=(0,r.Uk)("已毕业"),g=(0,r.Uk)("已离职"),h=(0,r.Uk)("编辑"),w=(0,r.Uk)("删除"),b=(0,r.Uk)("教师"),c=(0,r.Uk)("学生"),f=(0,r.Uk)("添加");function W(e,l,a,t,W,_){const F=(0,r.up)("Nav"),V=(0,r.up)("el-button"),v=(0,r.up)("el-upload"),k=(0,r.up)("el-form-item"),x=(0,r.up)("el-form"),y=(0,r.up)("el-table-column"),U=(0,r.up)("el-tag"),N=(0,r.up)("el-popconfirm"),$=(0,r.up)("el-table"),C=(0,r.up)("el-radio"),T=(0,r.up)("el-radio-group"),q=(0,r.up)("el-option"),z=(0,r.up)("el-select"),j=(0,r.up)("el-input"),E=(0,r.up)("el-dialog");return(0,r.wg)(),(0,r.iD)(r.HY,null,[o,(0,r._)("body",null,[(0,r.Wm)(F),m,(0,r._)("div",u,[(0,r.Wm)(x,{inline:!0},{default:(0,r.w5)((()=>[(0,r.Wm)(k,null,{default:(0,r.w5)((()=>[(0,r.Wm)(V,{type:"primary",onClick:l[0]||(l[0]=l=>e.dialogVisible=!0)},{default:(0,r.w5)((()=>[d])),_:1}),(0,r.Wm)(v,{class:"upload-demo",action:"","on-change":e.handleChange,accept:".csv","auto-upload":!1},{default:(0,r.w5)((()=>[(0,r.Wm)(V,{type:"primary",style:{"margin-left":"20px","margin-right":"20px","margin-top":"10px"}},{default:(0,r.w5)((()=>[i])),_:1})])),_:1},8,["on-change"])])),_:1})])),_:1}),(0,r.Wm)($,{data:e.tableData},{default:(0,r.w5)((()=>[(0,r.Wm)(y,{fixed:"",prop:"id",label:"学号/工号",width:"120px"}),(0,r.Wm)(y,{prop:"role",label:"身份",width:"120px"}),(0,r.Wm)(y,{prop:"name",label:"姓名",width:"120px"}),(0,r.Wm)(y,{prop:"college",label:"学院",width:"120px"}),(0,r.Wm)(y,{prop:"major",label:"专业",width:"120px"}),(0,r.Wm)(y,{prop:"idNumber",label:"身份证号",width:"180px"}),(0,r.Wm)(y,{prop:"phoneNumber",label:"手机号",width:"120px"}),(0,r.Wm)(y,{prop:"email",label:"邮箱",width:"180px"}),(0,r.Wm)(y,{prop:"state",label:"状态",width:"120px"},{default:(0,r.w5)((e=>[1===e.row.state?((0,r.wg)(),(0,r.j4)(U,{key:0,type:"success"},{default:(0,r.w5)((()=>[s])),_:1})):(0,r.kq)("",!0),2===e.row.state?((0,r.wg)(),(0,r.j4)(U,{key:1,type:"success"},{default:(0,r.w5)((()=>[p])),_:1})):(0,r.kq)("",!0),3===e.row.state?((0,r.wg)(),(0,r.j4)(U,{key:2,type:"info"},{default:(0,r.w5)((()=>[n])),_:1})):(0,r.kq)("",!0),4===e.row.state?((0,r.wg)(),(0,r.j4)(U,{key:3,type:"info"},{default:(0,r.w5)((()=>[g])),_:1})):(0,r.kq)("",!0)])),_:1}),(0,r.Wm)(y,{fixed:"right",prop:"icon",label:"操作",width:"170px"},{default:(0,r.w5)((()=>[(0,r._)("div",null,[(0,r.Wm)(V,{onClick:l[1]||(l[1]=l=>e.editHandle(e.scope.row.id))},{default:(0,r.w5)((()=>[h])),_:1}),(0,r.Wm)(N,{title:"确认删除吗？"},{reference:(0,r.w5)((()=>[(0,r.Wm)(V,{type:"danger"},{default:(0,r.w5)((()=>[w])),_:1})])),_:1})])])),_:1})])),_:1},8,["data"]),(0,r.Wm)(E,{modelValue:e.dialogVisible,"onUpdate:modelValue":l[10]||(l[10]=l=>e.dialogVisible=l),title:"添加用户",width:"600px"},{default:(0,r.w5)((()=>[(0,r.Wm)(x,{ref:"ruleForm",model:e.ruleForm,rules:e.editRules,"label-width":"120px",class:"demo-ruleForm",size:e.formSize},{default:(0,r.w5)((()=>[(0,r.Wm)(k,{label:"角色",prop:"role"},{default:(0,r.w5)((()=>[(0,r.Wm)(T,{modelValue:e.ruleForm.role,"onUpdate:modelValue":l[2]||(l[2]=l=>e.ruleForm.role=l)},{default:(0,r.w5)((()=>[(0,r.Wm)(C,{label:"1","model-value":"1"},{default:(0,r.w5)((()=>[b])),_:1}),(0,r.Wm)(C,{label:"2","model-value":"2"},{default:(0,r.w5)((()=>[c])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,r.Wm)(k,{label:"学院"},{default:(0,r.w5)((()=>[(0,r.Wm)(z,{modelValue:e.ruleForm.college,"onUpdate:modelValue":l[3]||(l[3]=l=>e.ruleForm.college=l),placeholder:"选择学院"},{default:(0,r.w5)((()=>[(0,r.Wm)(q,{label:"学院1",value:"1"}),(0,r.Wm)(q,{label:"学院2",value:"2"})])),_:1},8,["modelValue"])])),_:1}),(0,r.Wm)(k,{label:"专业"},{default:(0,r.w5)((()=>[(0,r.Wm)(z,{modelValue:e.ruleForm.major,"onUpdate:modelValue":l[4]||(l[4]=l=>e.ruleForm.major=l),placeholder:"选择专业"},{default:(0,r.w5)((()=>[(0,r.Wm)(q,{label:"专业1",value:"11"}),(0,r.Wm)(q,{label:"专业2",value:"21"})])),_:1},8,["modelValue"])])),_:1}),(0,r.Wm)(k,{label:"姓名",prop:"name"},{default:(0,r.w5)((()=>[(0,r.Wm)(j,{modelValue:e.ruleForm.name,"onUpdate:modelValue":l[5]||(l[5]=l=>e.ruleForm.name=l)},null,8,["modelValue"])])),_:1}),(0,r.Wm)(k,{label:"学号/工号",prop:"id",ref:"id"},{default:(0,r.w5)((()=>[(0,r.Wm)(j,{modelValue:e.ruleForm.id,"onUpdate:modelValue":l[6]||(l[6]=l=>e.ruleForm.id=l)},null,8,["modelValue"])])),_:1},512),(0,r.Wm)(k,{label:"身份证号",prop:"idNumber",ref:"idNumber"},{default:(0,r.w5)((()=>[(0,r.Wm)(j,{modelValue:e.ruleForm.idNumber,"onUpdate:modelValue":l[7]||(l[7]=l=>e.ruleForm.idNumber=l)},null,8,["modelValue"])])),_:1},512),(0,r.Wm)(k,{label:"手机号",prop:"phoneNumber"},{default:(0,r.w5)((()=>[(0,r.Wm)(j,{modelValue:e.ruleForm.phoneNumber,"onUpdate:modelValue":l[8]||(l[8]=l=>e.ruleForm.phoneNumber=l)},null,8,["modelValue"])])),_:1}),(0,r.Wm)(k,{label:"邮箱",prop:"email"},{default:(0,r.w5)((()=>[(0,r.Wm)(j,{modelValue:e.ruleForm.email,"onUpdate:modelValue":l[9]||(l[9]=l=>e.ruleForm.email=l)},null,8,["modelValue"])])),_:1}),(0,r.Wm)(k,null,{default:(0,r.w5)((()=>[(0,r.Wm)(V,{type:"primary",onClick:e.submitForm},{default:(0,r.w5)((()=>[f])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model","rules","size"])])),_:1},8,["modelValue"])])])],64)}a(1703);var _=a(5478),F={name:"userManage",components:{Nav:_.Z},data(){let e=(e,l,a)=>{const r="^[a-zA-Z一-龥]+$",t=new RegExp(r);return-1===l.search(t)?(a(new Error("姓名输入只能为中英文")),!1):!(this.length>32)||(a(new Error("仅支持32字符以内输入")),!1)},l=(e,l,a)=>(console.log(this.ruleForm.role),2!=l[0]||2!=l[1]?(a(new Error("工号/学号前两位需为22")),!1):isNaN(l)?(a(new Error("输入只能为数字")),!1):"1"===this.ruleForm.role?8===l.length||(a(new Error("请输入8位工号")),!1):"2"===this.ruleForm.role?6===l.length||(a(new Error("请输入6位学号")),!1):void 0);return{dialogVisible:!1,ruleForm:{},editRules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"},{validator:e,trigger:"blur"}],id:[{required:!0,message:"请输入学号/工号",trigger:"blur"},{validator:l,trigger:"blur"}],idNumber:[{required:!0,message:"请输入身份证号",trigger:"blur"},{pattern:"/(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)/",message:"输入格式不正确，请检查输入",trigger:"blur"}],phoneNumber:[{pattern:"^1[0-9]{10}$",message:"请输入以1开头的11位数字",trigger:"blur"}],email:[{pattern:"^[\\w\\-.]+@[a-z0-9]+(-[a-z0-9]+)?(\\.[a-z0-9]+(-[a-z0-9]+)?)*\\.[a-z]{2,4}$",message:"邮箱格式不正确",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]},tableData:[{role:"0",name:"admin",id:"000000",idNumber:"123456789012345678",phoneNumber:"12345678901",email:"12345678901@test.cn",state:1,major:"专业1",college:"学院1"},{role:"1",name:"test",id:"000000",idNumber:"123456789012345678",phoneNumber:"12345678901",email:"12345678901@test.cn",state:3}]}},created(){this.getUserForm()},methods:{getUserForm(){this.$axios.get("/admin/user/list").then((e=>{this.tableData=e.data.data}))},submitForm(){this.$refs.ruleForm.validate((e=>{e?this.$axios.post("/admin/user/"+(this.ruleForm.id?"update":"save"),this.ruleForm).then((e=>{this.$message({showClose:!0,message:"操作成功",type:"success",onClose:()=>{this.getUserForm()}}),this.dialogVisible=!1})):this.$nextTick((()=>{this.scrollToTop(this.$refs.ruleForm.$el)}))}))},handleChange(e){this.fileTemp=e.raw,this.fileTemp?".csv"===this.fileTemp.type||"application/vnd.ms-excel"===this.fileTemp.type?this.importcsv(e.raw):this.$message({type:"warning",message:"附件格式错误，请删除后重新上传！"}):this.$message({type:"warning",message:"请上传附件！"})},importcsv(e){Papa.parse(e,{complete(e){console.log(e);let l=[];for(let a=0;a<e.data.length;a++){let r={};r.number=e.data[a][0],r.name=e.data[a][1],r.nameRemark=e.data[a][2],r.index=e.data[a][3],l.push(r)}l.splice(0,1),console.log("data",l),this.tableData=l}})},editHandle(e){this.$axios.get("/sys/menu/info/"+e).then((e=>{this.ruleForm=e.data.data,this.dialogVisible=!0}))},scrollToTop(e){const l=Array.from(e.querySelectorAll(".is-error"));if(!l.length)throw new Error("有错误，但是找不到错误位置")}}},V=a(89);const v=(0,V.Z)(F,[["render",W],["__scopeId","data-v-0f8330b4"]]);var k=v}}]);
//# sourceMappingURL=752.f11ca27c.js.map